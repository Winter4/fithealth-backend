import { Composer, Keyboard } from "grammy";
import type { CustomContext } from "@src/context";
import { enter as enterMainMenu } from "../main-menu.scene";

export const sceneId = "SET_TARGET";

// alias = value
enum setTargetKeys {
  "–ü–æ—Ö—É–¥–µ–Ω–∏–µ" = "üîΩ –ü–æ—Ö—É–¥–µ–Ω–∏–µ",
  "–£–¥–µ—Ä–∂–∞–Ω–∏–µ –≤–µ—Å–∞" = "üîÑ –£–¥–µ—Ä–∂–∞–Ω–∏–µ –≤–µ—Å–∞",
  "–ù–∞–±–æ—Ä –≤–µ—Å–∞" = "üîº –ù–∞–±–æ—Ä –≤–µ—Å–∞",
}
const markup = {
  keys: setTargetKeys,
  keyboard: new Keyboard()
    .text(setTargetKeys.–ü–æ—Ö—É–¥–µ–Ω–∏–µ)
    .text(setTargetKeys["–£–¥–µ—Ä–∂–∞–Ω–∏–µ –≤–µ—Å–∞"])
    .text(setTargetKeys["–ù–∞–±–æ—Ä –≤–µ—Å–∞"])
    .row()
    .resized(),
};

// - - - - - - - //

export async function enter(ctx: CustomContext) {
  await ctx.cache.update(ctx.from!.id.toString(), { scene: sceneId });
  return ctx.reply("–í—ã–±–µ—Ä–∏—Ç–µ –í–∞—à—É —Ü–µ–ª—å", {
    reply_markup: markup.keyboard,
  });
}

// - - - - - - - //

const setTarget = new Composer<CustomContext>();

setTarget.hears(setTargetKeys.–ü–æ—Ö—É–¥–µ–Ω–∏–µ, async (ctx: CustomContext) => {
  await ctx.db.user.update({
    where: { tg_id: ctx.from!.id.toString() },
    data: { target: "LOSE" },
  });

  return enterMainMenu(ctx);
});

setTarget.hears(setTargetKeys["–£–¥–µ—Ä–∂–∞–Ω–∏–µ –≤–µ—Å–∞"], async (ctx: CustomContext) => {
  await ctx.db.user.update({
    where: { tg_id: ctx.from!.id.toString() },
    data: { target: "KEEP" },
  });

  return enterMainMenu(ctx);
});

setTarget.hears(setTargetKeys["–ù–∞–±–æ—Ä –≤–µ—Å–∞"], async (ctx: CustomContext) => {
  await ctx.db.user.update({
    where: { tg_id: ctx.from!.id.toString() },
    data: { target: "GAIN" },
  });

  return enterMainMenu(ctx);
});

/*
setSex.hears(backKey, async (ctx: CustomContext) => {
  return ctx.reply("–ù–∞–∑–∞–¥");
});
*/

export default setTarget;
